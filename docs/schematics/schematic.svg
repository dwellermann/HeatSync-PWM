<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="800" height="400" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
  
  <!-- Title -->
  <text x="400" y="30" font-family="Arial, sans-serif" font-size="20" fill="#2c3e50" text-anchor="middle" font-weight="bold">HeatSync PWM Translator - Circuit Schematic</text>
  
  <!-- Viessmann EM-SM1 Controller -->
  <g id="viessmann">
    <rect x="20" y="100" width="140" height="200" rx="5" fill="#ff6b35" stroke="#d95629" stroke-width="2"/>
    <text x="90" y="130" font-family="Arial, sans-serif" font-size="14" fill="#ffffff" text-anchor="middle" font-weight="bold">Viessmann</text>
    <text x="90" y="150" font-family="Arial, sans-serif" font-size="12" fill="#ffffff" text-anchor="middle">EM-SM1</text>
    <text x="90" y="170" font-family="Arial, sans-serif" font-size="10" fill="#ffffff" text-anchor="middle">Solar Controller</text>
    
    <!-- PWM Output -->
    <circle cx="160" cy="200" r="4" fill="#ffffff"/>
    <text x="100" y="205" font-family="Arial, sans-serif" font-size="10" fill="#ffffff" text-anchor="middle">PWM OUT</text>
    <text x="90" y="225" font-family="Arial, sans-serif" font-size="9" fill="#ffccbb" text-anchor="middle">(inverted)</text>
    <text x="90" y="240" font-family="Arial, sans-serif" font-size="9" fill="#ffccbb" text-anchor="middle">90% = MIN</text>
  </g>
  
  <!-- Connection Line -->
  <line x1="160" y1="200" x2="240" y2="200" stroke="#333" stroke-width="2"/>
  
  <!-- ILD213T Optocoupler -->
  <g id="optocoupler">
    <rect x="240" y="160" width="100" height="80" rx="5" fill="#34495e" stroke="#2c3e50" stroke-width="2"/>
    <text x="290" y="185" font-family="Arial, sans-serif" font-size="12" fill="#ffffff" text-anchor="middle" font-weight="bold">ILD213T</text>
    <text x="290" y="203" font-family="Arial, sans-serif" font-size="10" fill="#ecf0f1" text-anchor="middle">Optocoupler</text>
    
    <!-- LED symbol (input side) -->
    <circle cx="260" cy="220" r="3" fill="#e74c3c"/>
    <line x1="258" y1="218" x2="252" y2="212" stroke="#e74c3c" stroke-width="1"/>
    <polygon points="252,212 250,214 254,214" fill="#e74c3c"/>
    
    <!-- Phototransistor symbol (output side) -->
    <circle cx="320" cy="220" r="3" fill="#3498db"/>
    <line x1="315" y1="215" x2="309" y2="209" stroke="#f39c12" stroke-width="1"/>
    <polygon points="309,209 307,211 311,211" fill="#f39c12"/>
    
    <!-- Isolation barrier -->
    <line x1="290" y1="165" x2="290" y2="235" stroke="#e74c3c" stroke-width="1" stroke-dasharray="3,3"/>
    
    <circle cx="240" cy="200" r="4" fill="#ffffff"/>
    <circle cx="340" cy="200" r="4" fill="#ffffff"/>
  </g>
  
  <!-- Connection Line -->
  <line x1="340" y1="200" x2="420" y2="200" stroke="#333" stroke-width="2"/>
  
  <!-- Arduino Nano -->
  <g id="arduino">
    <rect x="420" y="100" width="160" height="200" rx="5" fill="#1a659e" stroke="#004e89" stroke-width="2"/>
    <text x="500" y="130" font-family="Arial, sans-serif" font-size="14" fill="#ffffff" text-anchor="middle" font-weight="bold">Arduino Nano</text>
    <text x="500" y="150" font-family="Arial, sans-serif" font-size="10" fill="#ffffff" text-anchor="middle">ATmega328P</text>
    
    <!-- Input Pin -->
    <circle cx="420" cy="200" r="4" fill="#ffffff"/>
    <text x="460" y="205" font-family="Arial, sans-serif" font-size="9" fill="#ffffff" text-anchor="middle">D2 (Input)</text>
    
    <!-- Output Pin -->
    <circle cx="580" cy="200" r="4" fill="#ffffff"/>
    <text x="540" y="205" font-family="Arial, sans-serif" font-size="9" fill="#ffffff" text-anchor="middle">D9 (PWM)</text>
    
    <!-- USB Power -->
    <rect x="485" y="260" width="30" height="15" rx="2" fill="#95a5a6" stroke="#7f8c8d" stroke-width="1"/>
    <text x="500" y="270" font-family="Arial, sans-serif" font-size="8" fill="#2c3e50" text-anchor="middle" font-weight="bold">USB</text>
    <line x1="500" y1="275" x2="500" y2="290" stroke="#7f8c8d" stroke-width="2"/>
    <text x="500" y="295" font-family="Arial, sans-serif" font-size="9" fill="#ffffff" text-anchor="middle">5V Power</text>
    
    <!-- Code indication -->
    <text x="500" y="175" font-family="Courier New, monospace" font-size="8" fill="#ecf0f1" text-anchor="middle">pulseIn()</text>
    <text x="500" y="188" font-family="Courier New, monospace" font-size="8" fill="#ecf0f1" text-anchor="middle">map()</text>
    <text x="500" y="225" font-family="Courier New, monospace" font-size="8" fill="#ecf0f1" text-anchor="middle">Timer1.pwm()</text>
  </g>
  
  <!-- Connection Line -->
  <line x1="580" y1="200" x2="640" y2="200" stroke="#333" stroke-width="2"/>
  
  <!-- OEG Pump -->
  <g id="pump">
    <rect x="640" y="100" width="140" height="200" rx="5" fill="#27ae60" stroke="#229954" stroke-width="2"/>
    <text x="710" y="130" font-family="Arial, sans-serif" font-size="14" fill="#ffffff" text-anchor="middle" font-weight="bold">OEG Pump</text>
    <text x="710" y="150" font-family="Arial, sans-serif" font-size="12" fill="#ffffff" text-anchor="middle">Circulation Pump</text>
    
    <!-- PWM Input -->
    <circle cx="640" cy="200" r="4" fill="#ffffff"/>
    <text x="700" y="205" font-family="Arial, sans-serif" font-size="10" fill="#ffffff" text-anchor="middle">PWM IN</text>
    <text x="710" y="225" font-family="Arial, sans-serif" font-size="9" fill="#a8e6cf" text-anchor="middle">(standard)</text>
    <text x="710" y="240" font-family="Arial, sans-serif" font-size="9" fill="#a8e6cf" text-anchor="middle">90% = MAX</text>
    
    <!-- Pump icon -->
    <circle cx="710" cy="265" r="18" fill="none" stroke="#ffffff" stroke-width="2"/>
    <path d="M 702 265 L 710 260 L 718 265 L 710 270 Z" fill="#ffffff"/>
  </g>
  
  <!-- Ground connections -->
  <g id="ground">
    <line x1="90" y1="300" x2="90" y2="320" stroke="#333" stroke-width="2"/>
    <line x1="80" y1="320" x2="100" y2="320" stroke="#333" stroke-width="2"/>
    <line x1="85" y1="325" x2="95" y2="325" stroke="#333" stroke-width="1.5"/>
    <line x1="88" y1="330" x2="92" y2="330" stroke="#333" stroke-width="1"/>
    <text x="90" y="350" font-family="Arial, sans-serif" font-size="9" fill="#333" text-anchor="middle">GND</text>
    
    <line x1="500" y1="300" x2="500" y2="320" stroke="#333" stroke-width="2"/>
    <line x1="490" y1="320" x2="510" y2="320" stroke="#333" stroke-width="2"/>
    <line x1="495" y1="325" x2="505" y2="325" stroke="#333" stroke-width="1.5"/>
    <line x1="498" y1="330" x2="502" y2="330" stroke="#333" stroke-width="1"/>
    <text x="500" y="350" font-family="Arial, sans-serif" font-size="9" fill="#333" text-anchor="middle">GND</text>
    
    <line x1="710" y1="300" x2="710" y2="320" stroke="#333" stroke-width="2"/>
    <line x1="700" y1="320" x2="720" y2="320" stroke="#333" stroke-width="2"/>
    <line x1="705" y1="325" x2="715" y2="325" stroke="#333" stroke-width="1.5"/>
    <line x1="708" y1="330" x2="712" y2="330" stroke="#333" stroke-width="1"/>
    <text x="710" y="350" font-family="Arial, sans-serif" font-size="9" fill="#333" text-anchor="middle">GND</text>
  </g>
  
  <!-- Signal flow arrows -->
  <g id="arrows">
    <text x="200" y="185" font-family="Arial, sans-serif" font-size="9" fill="#666" text-anchor="middle">PWM Signal</text>
    <text x="380" y="185" font-family="Arial, sans-serif" font-size="9" fill="#666" text-anchor="middle">Isolated</text>
    <text x="610" y="185" font-family="Arial, sans-serif" font-size="9" fill="#666" text-anchor="middle">500 Hz PWM</text>
  </g>
  
  <!-- Legend -->
  <g id="legend">
    <text x="20" y="380" font-family="Arial, sans-serif" font-size="10" fill="#666" font-weight="bold">Key Features:</text>
    <text x="20" y="395" font-family="Arial, sans-serif" font-size="9" fill="#666">• Galvanic isolation via ILD213T optocoupler</text>
    <text x="280" y="395" font-family="Arial, sans-serif" font-size="9" fill="#666">• Programmable signal mapping</text>
    <text x="500" y="395" font-family="Arial, sans-serif" font-size="9" fill="#666">• Safe 5V USB power supply</text>
  </g>
  
</svg>